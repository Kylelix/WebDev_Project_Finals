<!DOCTYPE html>
<html>
<head>
<title>Welcome - Travel Booking</title>

</head>
<body>

<!-- LOGIN POPUP OVERLAY -->
<div id="loginOverlay" class="login-overlay">
    <div class="login-popup">
        <h2>Login Required</h2>
        <p>Please login first to make a booking.</p>
        <a href="logreg.php" class="popup-btn">Go to Login</a>
    </div>
</div>

<!-- TOP BAR -->
<div class="topbar">
    <a href="logreg.php" class="nav-btn">Sign In / Register</a>
</div>

<!-- SEARCH BAR -->
<div class="search-bar">
    <input type="text" id="searchBox" class="search-input" placeholder="Search a place...">
    <button class="search-btn" onclick="applySearch()">Search</button>
</div>


<!-- 3 COLUMNS -->
<div class="columns">

    <!-- HOTELS -->
    <div class="col">
        <div class="col-head">
            <div class="col-title">HOTELS</div>
            <div class="col-arrows">
                <button class="arrow" onclick="prevHotel()">&lt;</button>
                <button class="arrow" onclick="nextHotel()">&gt;</button>
            </div>
        </div>

        <div class="col-body">
            <img id="hotel-img" class="item-img">
            <div id="hotel-name" class="item-name"></div>
            <div id="hotel-loc" class="location-text"></div>

            <div class="card-actions">
                <a id="hotel-book" class="book-btn-small" href="#" onclick="showLoginPopup(); return false;">Book</a>
                <button id="hotel-map-btn" class="map-btn-small" onclick="loadSelectedMap('hotel')">Load Map</button>
            </div>
        </div>
    </div>

    <!-- RESTAURANTS -->
    <div class="col">
        <div class="col-head">
            <div class="col-title">RESTAURANTS</div>
            <div class="col-arrows">
                <button class="arrow" onclick="prevRestaurant()">&lt;</button>
                <button class="arrow" onclick="nextRestaurant()">&gt;</button>
            </div>
        </div>

        <div class="col-body">
            <img id="restaurant-img" class="item-img">
            <div id="restaurant-name" class="item-name"></div>
            <div id="restaurant-loc" class="location-text"></div>

            <div class="card-actions">
                <a id="restaurant-book" class="book-btn-small" href="#" onclick="showLoginPopup(); return false;">Book</a>
                <button id="restaurant-map-btn" class="map-btn-small" onclick="loadSelectedMap('restaurant')">Load Map</button>
            </div>
        </div>
    </div>

    <!-- ACTIVITIES -->
    <div class="col">
        <div class="col-head">
            <div class="col-title">ACTIVITIES</div>
            <div class="col-arrows">
                <button class="arrow" onclick="prevActivity()">&lt;</button>
                <button class="arrow" onclick="nextActivity()">&gt;</button>
            </div>
        </div>

        <div class="col-body">
            <img id="activity-img" class="item-img">
            <div id="activity-name" class="item-name"></div>
            <div id="activity-loc" class="location-text"></div>

            <div class="card-actions">
                <a id="activity-book" class="book-btn-small" href="#" onclick="showLoginPopup(); return false;">Book</a>
                <button id="activity-map-btn" class="map-btn-small" onclick="loadSelectedMap('activity')">Load Map</button>
            </div>
        </div>
    </div>
</div>

<!-- MAPBOX JS LOGIC -->
 <script>
mapboxgl.accessToken = "pk.eyJ1Ijoia3lsZWxpeCIsImEiOiJjbWl3ejMzdmIwMWU5M2VxczJyOHBxbXZ2In0.2GzAyBPJlO_X24QBTy-MYQ";

var map = new mapboxgl.Map({
    container: "map", 
    style: "mapbox://styles/mapbox/streets-v11", 
    center: [77.2090, 28.6139], 
    zoom: 10
});

var activeMarker = null;

function loadSelectedMap(type) {

    var list = null;
    var index = 0;

    if (type == "hotel") {
        list = hotels;
        index = hIndex;
    }

    if (type == "restaurant") {
        list = restaurants;
        index = rIndex;
    }

    if (type == "activity") {
        list = activities;
        index = aIndex;
    }

    var place = list[index];

    if (place == null) {
        alert("No place loaded.");
        return;
    }

    var address = place["address"];

    if (address == null || address == "") {
        alert("No address available.");
        return;
    }
    var url = "https://api.mapbox.com/geocoding/v5/mapbox.places/" + 
    encodeURIComponent(address) + 
    ".json?access_token=" + mapboxgl.accessToken;

    fetch(url)
    .then(function(r){ return r.json(); })
    .then(function(data){

        if (data.features.length > 0) {

            var lon = data.features[0].center[0];
            var lat = data.features[0].center[1];

            moveMap(lon, lat);

        } else {
            alert("MapBox could not find this address.");
        }
    });
}

function moveMap(lon, lat) {

    if (activeMarker != null) {
        activeMarker.remove();
    }

    activeMarker = new mapboxgl.Marker().setLngLat([lon, lat]).addTo(map);

    map.flyTo({
        center: [lon, lat],
        zoom: 14
    });
}

 </script>

</body>
</html>